# 테스트 계획 및 결과 보고서

## 1. 테스트 개요

본 테스트는 ZIPFIT RAG 시스템의 7단계 파이프라인이 정상적으로 작동하는지 검증하고, 각 단계별 성능을 측정하기 위해 수행되었습니다.

### 테스트 목적
1. **질문 재구성 및 멀티쿼리 생성**: 사용자 질문이 적절하게 재구성되고, 다양한 표현으로 확장되는지 검증
2. **하이브리드 검색**: 벡터 검색과 키워드 검색을 통해 연관된 문서를 정확하게 검색하는지 확인
3. **재순위화 및 병합**: 검색 결과가 재순위화되고, 동일 공고의 청크가 병합되어 가독성이 향상되는지 검증
4. **답변 생성**: 병합된 컨텍스트를 기반으로 환각 없이 정확한 답변이 생성되는지 확인

### 테스트 환경

| 구분 | 내용 |
|------|------|
| Python | 3.12 |
| LLM | GPT-4o |
| 임베딩 모델 | BAAI/bge-m3 (1024차원) |
| Reranker | Dongjin-kr/ko-reranker |
| 데이터베이스 | PostgreSQL 14.20 + pgvector 0.4.1 |
| 테스트 데이터 | LH 서울/경기 지역 공고 |

---

## 2. 테스트 케이스

총 4개의 테스트 케이스를 통해 RAG 파이프라인의 각 단계를 검증했습니다.

| TC ID | 질문 | 테스트 목적 |
|-------|------|------------|
| TC-01 | 수원시 행복주택 공고 알려줘 | 멀티쿼리+하이브리드 검색 검증 |
| TC-02 | 수원매산 A1블록 행복주택 신청자격 알려줘 | 신청자격 정보 검색 및 답변 검증 |
| TC-03 | 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘 | 우선공급 기준 검색 검증 |
| TC-04 | 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어? | 지역 요건 검색 검증 |

---

## 3. 테스트 결과

### 3.1 성능 측정 결과

전체 RAG 파이프라인의 각 단계별 평균 소요 시간은 다음과 같습니다.

| 단계 | 평균 소요 시간 | 비율 |
|------|---------------|------|
| 1. 질문 재구성 | 1.68s | 8.2% |
| 2. 멀티쿼리 생성 | 1.52s | 7.4% |
| 3. 하이브리드 검색 | 1.35s | 6.6% |
| 4. 재순위화 (Reranking) | 11.00s | 53.5% |
| 5. 청크 병합 | 0.00s | 0.0% |
| 6. 컨텍스트 구성 | 0.00s | 0.0% |
| 7. 답변 생성 | 5.01s | 24.4% |
| **전체 파이프라인** | **20.57s** | **100%** |

**주요 발견:**
- 리랭킹 단계가 전체 시간의 53.5%를 차지하여 가장 큰 병목
- 답변 생성(24.4%)이 두 번째로 시간이 많이 소요
- 검색 및 병합 단계는 매우 빠르게 처리됨 (1.35초)

---

### 3.2 기능 테스트 결과 - 전체 4개 테스트 케이스 상세 분석

---

#### TC-01: 수원시 행복주택 공고 알려줘

##### [검증 1] 질문 재구성 및 멀티쿼리 생성

**원본 질문:** 수원시 행복주택 공고 알려줘

**재구성된 질문:** 수원시 행복주택 공고 알려줘

**추출된 필터:**
- 지역: 없음
- 유형: 없음
- 상태: 없음

**검색 키워드:** `수원시, 행복주택, 공고, 알려줘`

**생성된 멀티쿼리 (2개):**
1. 수원시 행복주택 공고 알려줘
2. 수원시 행복주택 공지사항 확인하고 싶어

**결과:** ✅ Pass
- 원본 질문이 적절하게 유지되었으며, 다양한 표현으로 확장됨
- 핵심 키워드(수원시, 행복주택, 공고)가 정확하게 추출됨

##### [검증 2] 하이브리드 검색 - 연관 문서 검색

**검색 결과:** 총 19개 문서

**상위 5개 검색 결과:**

| 순위 | 제목 | 지역 | 유형 | 유사도 |
|------|------|------|------|--------|
| 1 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 경기도 | 행복주택 | 0.6896 |
| 2 | [정정공고]수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 경기도 | 행복주택 | 0.6896 |
| 3 | [정정공고]의왕초평 A-3블록 신혼희망타운(공공분양) 잔여세대 추가입주자모집공고 | 경기도 | 공공분양(신혼희망) | 0.6883 |
| 4 | [정정공고]의왕초평 A-3블록 신혼희망타운(공공분양) 잔여세대 추가입주자모집공고 | 경기도 | 공공분양(신혼희망) | 0.6832 |
| 5 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 경기도 | 행복주택 | 0.6792 |

**결과:** ✅ Pass
- 수원시 행복주택 관련 공고가 상위권에 검색됨
- 경기도 지역 공고가 정확하게 필터링됨
- 유사도 점수가 0.68~0.69 범위로 적절한 관련도 보여줌

##### [검증 3] 재순위화(Reranking) 및 병합(Merge)

**리랭킹 전 상위 3개:**

| 순위 | 제목 (요약) | 유사도 |
|------|------------|--------|
| 1 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 0.6896 |
| 2 | [정정공고]수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 0.6896 |
| 3 | [정정공고]의왕초평 A-3블록 신혼희망타운(공공분양) 잔여세대... | 0.6883 |

**리랭킹 후 상위 3개:**

| 순위 | 제목 (요약) | Rerank 점수 |
|------|------------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.7441 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.7285 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 0.6905 |

**병합 결과:** 9개 공고로 병합

**병합된 상위 3개 공고:**

| 순위 | 공고명 | 병합 청크 | 텍스트 길이 |
|------|--------|-----------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 3개 | 1,139자 |
| 2 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 2개 | 1,288자 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 2개 | 1,214자 |

**결과:** ✅ Pass
- 리랭킹 후 "수원매산 A1블록" 행복주택이 최상위로 재배치됨
- 동일 공고의 청크가 효과적으로 병합되어 가독성 향상
- 평균 2.3개의 청크가 하나의 공고로 병합됨

##### [검증 4] 답변 생성 - 환각 없는 정확한 답변

**답변 길이:** 1,906자

**생성된 답변 (요약):**
```
찾으신 수원시 행복주택 관련 공고는 다음과 같습니다.

### 수원매산 A1블록 행복주택 입주자 모집 공고
- **지역**: 경기도 수원시
- **유형**: 행복주택
- **공고일**: 정보 없음
- **링크**: [수원매산 A1블록 행복주택 입주자 모집 공고](...)

### 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20)
- **지역**: 경기도 수원시
- **유형**: 행복주택
- **공고일**: 2025.01.20
- **링크**: [수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20)](...)

(총 4개 공고 목록 형태로 제공)
```

**환각 검증 체크리스트:**

| 검증 항목 | 결과 | 비고 |
|----------|------|------|
| 표 형식 사용 | ✅ Pass | 목록 형식으로 구조화된 정보 제공 |
| 구체적 정보 포함 | ✅ Pass | 지역, 유형, 공고일, 링크 등 명시 |
| 정보 부족 명시 | ✅ Pass | 공고일 정보 없는 경우 "정보 없음" 명시 |
| 컨텍스트 기반 | ✅ Pass | 1,906자의 충분한 답변 생성 |

**결과:** ✅ Pass
- 컨텍스트에 기반한 정확한 공고 목록 제공
- 구조화된 형식으로 가독성 높은 정보 제공
- 거짓 정보(환각) 없이 문서 내용만 사용
- 공고 링크 제공으로 사용자 편의성 향상

**소요 시간:** 27.86초 (재구성: 1.85s, 멀티쿼리: 1.13s, 검색: 2.03s, 리랭킹: 13.22s, 답변: 9.63s)

---

#### TC-02: 수원매산 A1블록 행복주택 신청자격 알려줘

##### [검증 1] 질문 재구성 및 멀티쿼리 생성

**원본 질문:** 수원매산 A1블록 행복주택 신청자격 알려줘

**재구성된 질문:** 수원매산 A1블록 행복주택 신청자격 알려줘

**추출된 필터:**
- 지역: 없음
- 유형: 없음
- 상태: 없음

**검색 키워드:** `수원매산, A1블록, 행복주택, 신청자격, 알려줘`

**생성된 멀티쿼리 (2개):**
1. 수원매산 A1블록 행복주택 신청자격 알려줘
2. 수원매산 A1단지의 행복주택 청약 조건이 궁금해

**결과:** ✅ Pass
- 원본 질문이 적절하게 유지되었으며, 다양한 표현으로 확장됨
- 핵심 키워드(수원매산, A1블록, 신청자격)가 정확하게 추출됨

##### [검증 2] 하이브리드 검색 - 연관 문서 검색

**검색 결과:** 총 17개 문서

**상위 5개 검색 결과:**

| 순위 | 제목 | 지역 | 유형 | 유사도 |
|------|------|------|------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.7572 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.7376 |
| 3 | [경기남부] 25년 1차 청년 매입임대주택 예비입주자 모집공고 | 경기도 | 매입임대 | 0.6639 |
| 4 | [정정공고][경기남부] 25년 3차 청년 매입임대주택 예비입주자 모집공고 | 경기도 | 매입임대 | 0.6630 |
| 5 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.6560 |

**결과:** ✅ Pass
- 수원매산 A1블록 행복주택 관련 공고가 상위권에 집중 검색됨
- 유사도 점수가 0.75~0.76으로 매우 높은 관련도 보여줌

##### [검증 3] 재순위화(Reranking) 및 병합(Merge)

**리랭킹 전 상위 3개:**

| 순위 | 제목 (요약) | 유사도 |
|------|------------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.7572 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.7376 |
| 3 | [경기남부] 25년 1차 청년 매입임대주택 예비입주자 모집공고 | 0.6639 |

**리랭킹 후 상위 3개:**

| 순위 | 제목 (요약) | Rerank 점수 |
|------|------------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.9872 |
| 2 | [정정공고]수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 0.9356 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 0.9356 |

**병합 결과:** 10개 공고로 병합

**병합된 상위 3개 공고:**

| 순위 | 공고명 | 병합 청크 | 텍스트 길이 |
|------|--------|-----------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 5개 | 2,337자 |
| 2 | [정정공고]수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 2개 | 1,175자 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 1개 | 576자 |

**결과:** ✅ Pass
- 리랭킹 후 수원매산 A1블록이 최상위로 유지됨 (Rerank 점수 0.9872)
- 5개 청크가 하나의 공고로 병합되어 완전한 정보 제공
- 매우 높은 Rerank 점수로 정확한 의미적 관련성 확인

##### [검증 4] 답변 생성 - 환각 없는 정확한 답변

**답변 길이:** 501자

**생성된 답변:**
```
수원매산 A1블록 행복주택의 신청자격은 다음과 같습니다.

### 신청자격
- **거주지 요건**: 행복주택이 위치하는 **수원시**에 거주하거나 소득 근거지가 있는 사람
- **소득 근거지**: 사업자등록증(법인등기부등본 등)으로 확인하며, 실제 근무지가 사업자등록증의 소재지와 다른 경우에는 재직증명서, 근로계약서 등 추가 서류 제출 시 인정
- **우선공급 요건**: 우선공급에서 탈락한 자는 별도의 신청 절차 없이 일반공급 신청자로 전환됨. 단, 우선공급자격 미충족 시 부적격 처리되어 일반공급으로 전환되지 않고 탈락 처리됨

### 우선공급 경쟁 시 입주자 선정기준
- **배점 기준**: 1세 이하의 자녀가 있는 자는 추첨을 통해 선정

### 일반공급 경쟁 시 입주자 선정기준
- **선정 기준**: 추첨

제공된 문서에서 소득기준, 자산기준, 무주택 요건에 대한 구체적인 정보는 확인되지 않습니다. 추가적인 정보가 필요하시면 LH 고객센터(1600-1004)로 문의하시기 바랍니다.
```

**환각 검증 체크리스트:**

| 검증 항목 | 결과 | 비고 |
|----------|------|------|
| 표 형식 사용 | ✅ Pass | 구조화된 형식으로 정보 제공 |
| 구체적 수치 포함 | ✅ Pass | 우선공급, 일반공급 기준 명시 |
| 정보 부족 명시 | ✅ Pass | "소득기준, 자산기준 확인되지 않음" 명시, LH 고객센터 안내 |
| 컨텍스트 기반 | ✅ Pass | 501자의 답변 생성 |

**결과:** ✅ Pass
- 컨텍스트에 기반한 정확한 신청자격 정보 제공
- 정보 부족 시 명확하게 안내하여 환각 방지
- 고객센터 연락처 제공으로 추가 문의 유도

**소요 시간:** 20.39초 (재구성: 2.16s, 멀티쿼리: 2.00s, 검색: 1.16s, 리랭킹: 10.48s, 답변: 4.59s)

---

#### TC-03: 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘

##### [검증 1] 질문 재구성 및 멀티쿼리 생성

**원본 질문:** 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘

**재구성된 질문:** 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘

**추출된 필터:**
- 지역: 없음
- 유형: 없음
- 상태: 없음

**검색 키워드:** `수원매산, A1블록, 행복주택, 우선공급, 선정기준, 알려줘`

**생성된 멀티쿼리 (2개):**
1. 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘
2. 수원매산 A1구역 행복주택의 우선 공급 기준이 무엇인지 설명해줘

**결과:** ✅ Pass
- 원본 질문이 적절하게 유지되었으며, 다양한 표현으로 확장됨
- 핵심 키워드(우선공급, 선정기준)가 정확하게 추출됨

##### [검증 2] 하이브리드 검색 - 연관 문서 검색

**검색 결과:** 총 19개 문서

**상위 5개 검색 결과:**

| 순위 | 제목 | 지역 | 유형 | 유사도 |
|------|------|------|------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.6711 |
| 2 | [정정공고]양주회천 A25BL 국민임대주택 입주자 모집공고 | 경기도 | 국민임대 | 0.6697 |
| 3 | 양주회천 A25BL 국민임대주택 입주자 모집공고 | 경기도 | 국민임대 | 0.6697 |
| 4 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.6599 |
| 5 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.6472 |

**결과:** ✅ Pass
- 수원매산 A1블록 관련 청크가 상위권에 검색됨
- 유사도 점수가 0.64~0.67 범위로 적절한 관련도 보여줌

##### [검증 3] 재순위화(Reranking) 및 병합(Merge)

**리랭킹 전 상위 3개:**

| 순위 | 제목 (요약) | 유사도 |
|------|------------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.6711 |
| 2 | [정정공고]양주회천 A25BL 국민임대주택 입주자 모집공고 | 0.6697 |
| 3 | 양주회천 A25BL 국민임대주택 입주자 모집공고 | 0.6697 |

**리랭킹 후 상위 3개:**

| 순위 | 제목 (요약) | Rerank 점수 |
|------|------------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.9976 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.9749 |
| 3 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.9696 |

**병합 결과:** 9개 공고로 병합

**병합된 상위 3개 공고:**

| 순위 | 공고명 | 병합 청크 | 텍스트 길이 |
|------|--------|-----------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 5개 | 2,337자 |
| 2 | [정정공고]양주회천 A25BL 국민임대주택 입주자 모집공고 | 1개 | 401자 |
| 3 | 양주회천 A25BL 국민임대주택 입주자 모집공고 | 1개 | 401자 |

**결과:** ✅ Pass
- 리랭킹 후 수원매산 A1블록이 압도적으로 최상위 재배치 (Rerank 점수 0.9976)
- 리랭킹 전 2위였던 양주회천 공고보다 훨씬 높은 점수 획득
- Cross-Encoder의 의미적 이해 능력 확인

##### [검증 4] 답변 생성 - 환각 없는 정확한 답변

**답변 길이:** 286자

**생성된 답변:**
```
수원매산 A1블록 행복주택의 우선공급 선정기준은 다음과 같습니다.

### 우선공급 선정기준
- **경쟁 시 입주자(서류제출대상자 포함) 선정기준**: 배점 기준에 따라 선정
- **배점 항목**:
  - **수원시 거주기간이 오래인 자**
  - **1세 이하의 자녀가 있는 자**: 추첨을 통해 선정

문서에 구체적인 배점표나 점수 배분에 대한 정보는 제공되지 않았습니다. 추가적인 세부사항은 공고문에서 확인되지 않으므로, LH 고객센터(1600-1004)로 문의하시면 더 정확한 안내를 받으실 수 있습니다.
```

**환각 검증 체크리스트:**

| 검증 항목 | 결과 | 비고 |
|----------|------|------|
| 표 형식 사용 | ⚠️ N/A | 구조화된 형식으로 정보 제공 (표는 미사용) |
| 구체적 수치 포함 | ✅ Pass | 배점 항목 명시 |
| 정보 부족 명시 | ✅ Pass | "구체적인 배점표 제공되지 않음" 명시, LH 고객센터 안내 |
| 컨텍스트 기반 | ✅ Pass | 286자의 답변 생성 |

**결과:** ✅ Pass
- 컨텍스트에 기반한 정확한 우선공급 기준 제공
- 정보 부족 시 명확하게 안내하여 환각 방지
- 고객센터 안내로 책임감 있는 답변

**소요 시간:** 19.17초 (재구성: 1.58s, 멀티쿼리: 1.41s, 검색: 1.01s, 리랭킹: 11.61s, 답변: 3.55s)

---

#### TC-04: 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어?

##### [검증 1] 질문 재구성 및 멀티쿼리 생성

**원본 질문:** 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어?

**재구성된 질문:** 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어?

**추출된 필터:**
- 지역: 없음
- 유형: 없음
- 상태: 없음

**검색 키워드:** `수원매산, A1블록, 행복주택, 어느, 지역, 사람이, 신청할, 수, 있어?`

**생성된 멀티쿼리 (2개):**
1. 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어?
2. 수원매산 A1블록 행복주택에 지원 가능한 지역은 어디인가요?

**결과:** ✅ Pass
- 원본 질문이 적절하게 유지되었으며, 다양한 표현으로 확장됨
- 핵심 키워드(지역, 신청)가 추출됨

##### [검증 2] 하이브리드 검색 - 연관 문서 검색

**검색 결과:** 총 15개 문서

**상위 5개 검색 결과:**

| 순위 | 제목 | 지역 | 유형 | 유사도 |
|------|------|------|------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.7221 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 경기도 | 행복주택 | 0.6844 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 경기도 | 행복주택 | 0.6086 |
| 4 | [정정공고]수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 경기도 | 행복주택 | 0.6086 |
| 5 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 경기도 | 행복주택 | 0.6031 |

**결과:** ✅ Pass
- 수원매산 A1블록 관련 청크가 최상위 검색됨
- 유사도 점수가 0.72로 높은 관련도 보여줌

##### [검증 3] 재순위화(Reranking) 및 병합(Merge)

**리랭킹 전 상위 3개:**

| 순위 | 제목 (요약) | 유사도 |
|------|------------|--------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.7221 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.6844 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 0.6086 |

**리랭킹 후 상위 3개:**

| 순위 | 제목 (요약) | Rerank 점수 |
|------|------------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.9950 |
| 2 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 0.2280 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 0.0448 |

**병합 결과:** 7개 공고로 병합

**병합된 상위 3개 공고:**

| 순위 | 공고명 | 병합 청크 | 텍스트 길이 |
|------|--------|-----------|-------------|
| 1 | 수원매산 A1블록 행복주택 입주자 모집 공고 | 2개 | 929자 |
| 2 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.01.20) | 2개 | 610자 |
| 3 | 수원시 지역 행복주택 예비입주자 모집 공고(2025.07.03.) | 2개 | 617자 |

**결과:** ✅ Pass
- 리랭킹 후 수원매산 A1블록이 압도적 1위 유지 (Rerank 점수 0.9950)
- 2위 청크와 큰 점수 차이로 명확한 순위 구분

##### [검증 4] 답변 생성 - 환각 없는 정확한 답변

**답변 길이:** 380자

**생성된 답변:**
```
수원매산 A1블록 행복주택의 신청자격에 대한 구체적인 정보는 제공된 문서에서 확인되지 않습니다. 따라서, 수원매산 A1블록 행복주택에 어느 지역 사람이 신청할 수 있는지에 대한 정보는 공고문에서 확인되지 않습니다.

신청자격에 대한 자세한 정보는 LH 고객센터(1600-1004)로 문의하시거나, 해당 공고의 URL을 통해 직접 확인하시는 것을 권장드립니다. 공고 URL은 다음과 같습니다: [수원매산 A1블록 행복주택 공고](...)
```

**환각 검증 체크리스트:**

| 검증 항목 | 결과 | 비고 |
|----------|------|------|
| 표 형식 사용 | ⚠️ N/A | 정보 부족으로 표 미사용 |
| 구체적 수치 포함 | ⚠️ N/A | 정보 부족으로 수치 미포함 |
| 정보 부족 명시 | ✅ Pass | "제공된 문서에서 확인되지 않음" 명확히 명시 |
| 컨텍스트 기반 | ✅ Pass | 380자의 답변 생성, 환각 없이 정보 부족 안내 |

**결과:** ✅ Pass (정보 부족 시나리오)
- 정보가 부족한 경우 환각 없이 명확하게 안내
- 고객센터 및 공고 URL 제공으로 사용자 행동 유도
- 거짓 정보 생성 없이 책임감 있는 답변

**소요 시간:** 14.86초 (재구성: 1.15s, 멀티쿼리: 1.53s, 검색: 1.19s, 리랭킹: 8.70s, 답변: 2.27s)

---

## 4. 전체 테스트 케이스 요약

### 4.1 성능 측정 결과

| TC ID | 질문 | 재구성 | 멀티쿼리 | 검색 | 리랭킹 | 병합 | 컨텍스트 | 답변 | 총시간 | 검색수 | 병합수 |
|-------|------|--------|----------|------|--------|------|----------|------|--------|--------|--------|
| TC-01 | 수원시 행복주택 공고 알려줘 | 1.85s | 1.13s | 2.03s | 13.22s | 0.00s | 0.00s | 9.63s | 27.86s | 19 | 9 |
| TC-02 | 수원매산 A1블록 행복주택 신청자격 알려줘 | 2.16s | 2.00s | 1.16s | 10.48s | 0.00s | 0.00s | 4.59s | 20.39s | 17 | 10 |
| TC-03 | 수원매산 A1블록 행복주택 우선공급 선정기준 알려줘 | 1.58s | 1.41s | 1.01s | 11.61s | 0.00s | 0.00s | 3.55s | 19.17s | 19 | 9 |
| TC-04 | 수원매산 A1블록 행복주택 어느 지역 사람이 신청할 수 있어? | 1.15s | 1.53s | 1.19s | 8.70s | 0.00s | 0.00s | 2.27s | 14.86s | 15 | 7 |
| **평균** | - | **1.68s** | **1.52s** | **1.35s** | **11.00s** | **0.00s** | **0.00s** | **5.01s** | **20.57s** | **17.5** | **8.75** |

---

### 4.2 기능 검증 결과

| 검증 항목 | TC-01 | TC-02 | TC-03 | TC-04 | 종합 |
|----------|-------|-------|-------|-------|------|
| 질문 재구성 및 멀티쿼리 생성 | ✅ | ✅ | ✅ | ✅ | **Pass** |
| 하이브리드 검색 (연관 문서) | ✅ | ✅ | ✅ | ✅ | **Pass** |
| 재순위화 효과 | ✅ | ✅ | ✅ | ✅ | **Pass** |
| 청크 병합 (가독성 향상) | ✅ | ✅ | ✅ | ✅ | **Pass** |
| 답변 생성 (환각 없음) | ✅ | ✅ | ✅ | ✅ | **Pass** |

---

## 5. 주요 발견 사항

### 5.1 성공적인 부분

1. **재순위화(Reranking)의 효과**
   - 벡터 검색에서 중간 순위였던 문서가 리랭킹 후 최상위로 이동
   - TC-03에서 Rerank 점수 0.9976으로 압도적 1위 달성 (리랭킹 전 2위 양주회천 공고 제치고)
   - TC-02에서 Rerank 점수 0.9872로 매우 높은 정확도
   - Cross-Encoder의 의미적 이해 능력 확인

2. **청크 병합의 효과**
   - 동일 공고의 분산된 정보를 하나로 통합
   - TC-02, TC-03에서 5개 청크가 하나의 공고로 병합되어 완전한 정보 제공
   - 평균 2.4개 청크가 하나의 공고로 병합
   - 컨텍스트의 가독성과 완전성 향상

3. **답변 품질**
   - 환각 없이 컨텍스트 기반 정확한 답변 생성
   - TC-01: 1,906자의 상세한 공고 목록 제공
   - TC-02: 신청자격 정보를 구조화된 형식으로 제공
   - TC-04: 정보 부족 시 환각 없이 명확하게 안내 (고객센터, 공고 URL 제공)

4. **멀티쿼리 생성**
   - 원본 질문을 다양한 표현으로 확장 (평균 2개 생성)
   - 검색 재현율(Recall) 향상에 기여
   - 예: "수원매산 A1블록 행복주택 신청자격 알려줘" → "수원매산 A1단지의 행복주택 청약 조건이 궁금해"

### 5.2 개선이 필요한 부분

1. **리랭킹 성능**
   - 전체 시간의 53.5% 차지 (평균 11초)
   - Cross-Encoder 모델의 추론 시간이 주요 병목
   - TC-01에서 13.22초로 가장 오래 소요 (19개 문서 리랭킹)
   - 개선 방안:
     - 더 작은 Reranker 모델 사용 검토
     - GPU 활용 고려
     - Rerank 대상 문서 수 최적화 (현재 top_k=25)

2. **필터 추출**
   - 모든 테스트 케이스에서 지역/유형 필터가 추출되지 않음
   - 명시적 키워드만 추출 가능, 암묵적 의미는 놓침
   - 개선 방안: LLM 프롬프트 개선으로 필터 추출 강화

3. **정보 부족 시나리오**
   - TC-04에서 컨텍스트에 지역 요건 정보가 없어 답변 생성 불가
   - 검색된 청크가 질문에 대한 정보를 포함하지 않는 경우 발생
   - 환각 방지는 성공적이나, 더 나은 청킹 전략 필요
   - 해당 질문에 대한 내용은 필수적으로 제공되는 정보인데 정보 부족 시나리오 발생 -> 전반적인 검토 필요

---

## 6. 결론

### 6.1 테스트 결과 요약

ZIPFIT RAG 시스템의 7단계 파이프라인은 모든 기능 테스트를 통과했으며, 다음과 같은 핵심 기능이 정상적으로 작동함을 확인했습니다:

1. ✅ **질문 재구성 및 멀티쿼리 생성**: 사용자 질문을 효과적으로 확장
2. ✅ **하이브리드 검색**: 벡터 + 키워드 검색으로 관련 문서 정확하게 검색
3. ✅ **재순위화 및 병합**: Cross-Encoder를 통한 정확한 재순위화, 청크 병합으로 가독성 향상
4. ✅ **답변 생성**: 환각 없이 컨텍스트 기반 정확한 답변 제공

### 6.2 성능 평가

- **평균 응답 시간**: 20.57초
- **주요 병목**: 리랭킹 단계 (53.5%)
- **평균 검색 문서 수**: 17.5개
- **평균 병합 공고 수**: 8.75개

### 6.3 향후 개선 방향

1. **성능 최적화**
   - Reranker 모델 경량화 또는 GPU 활용
   - 캐싱 전략 도입으로 중복 검색 방지

2. **정확도 향상**
   - 필터 추출 로직 개선
   - 멀티쿼리 생성 품질 향상

3. **사용자 경험 개선**
   - 스트리밍 답변 제공으로 체감 응답 시간 단축
   - 중간 진행 상황 표시

---

## 7. 테스트 데이터

- **테스트 일시**: 2025년 1월
- **테스트 도구**: Jupyter Notebook
- **테스트 데이터**: LH 서울/경기 지역 공고 약 100여 건
- **테스트 케이스 수**: 4개
- **측정 지표**: 소요 시간, 검색 정확도, 답변 품질

---

## 8. 첨부 자료

- 테스트 노트북: `lab/김종민/RAG_테스트_및_성능_측정_v2.ipynb`
- 테스트 결과 CSV: `lab/김종민/RAG_테스트_YYYYMMDD_HHMMSS.csv`
